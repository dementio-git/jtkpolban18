<templates xml:space="preserve">
  <t t-name="jtk_logbook_analytics.LogbookDashboard" owl="1">
    <div class="logbook-dashboard-wrapper p-3">
      <h2>ðŸ“Š Dashboard Analitik Logbook</h2>

      <!-- Pilih Project -->
      <div class="mb-3">
        <label class="form-label">ðŸ“˜ Pilih Project:</label>
        <select class="form-select"
                t-att-value="state.selectedProjectId"
                t-on-change="onProjectChange">
          <option value="">-- Pilih Project --</option>
          <t t-foreach="state.projects" t-as="proj" t-key="proj.id">
            <option t-att-value="proj.id">
              <t t-esc="proj.name"/>
            </option>
          </t>
        </select>
      </div>

      <!-- Pilih Minggu & Kelas (Horizontal) -->
      <t t-if="state.selectedProjectId">
        <div class="d-flex gap-4 flex-wrap align-items-end mb-4">
          <div style="flex: 1 1 300px;">
            <label class="form-label">ðŸ“… Pilih Minggu:</label>
            <select class="form-select"
                    t-att-value="state.selectedWeekId"
                    t-on-change="onWeekChange">
              <option value="">-- Pilih Minggu --</option>
              <t t-foreach="state.weeks" t-as="w" t-key="w.id">
                <option t-att-value="w.id">
                  <t t-esc="w.name"/>
                </option>
              </t>
            </select>
          </div>
          <div style="flex: 1 1 300px;">
            <label class="form-label">ðŸ‘¥ Pilih Kelas:</label>
            <select class="form-select"
                    t-att-value="state.selectedClassId"
                    t-on-change="onClassChange">
              <option value="">-- Pilih Kelas --</option>
              <t t-foreach="state.classes" t-as="cls" t-key="cls.id">
                <option t-att-value="cls.id">
                  <t t-esc="cls.name"/>
                </option>
              </t>
            </select>
          </div>
        </div>
      </t>

      <!-- Pesan jika belum pilih -->
      <t t-if="!state.selectedProjectId">
        <p class="text-muted">Silakan pilih project terlebih dahulu.</p>
      </t>
      <t t-if="state.selectedProjectId and !state.selectedWeekId">
        <p class="text-muted">Silakan pilih minggu untuk melihat grafik.</p>
      </t>

      <!-- Dua Grafik Horizontal -->
      <div class="d-flex flex-row flex-wrap gap-3">
        <!-- Grafik 1: Poin per Kelas -->
        <div style="flex: 1 1 48%; min-width: 350px; height: 400px;">
          <canvas t-ref="barChartRef"
                  style="width:100%;height:100%;display:block;"/>
          <t t-if="state.selectedWeekId and state.weekData.length === 0">
            <p class="text-warning">Tidak ada data label untuk minggu ini.</p>
          </t>
        </div>
        <!-- Grafik 2: Poin per Label -->
        <div style="flex: 1 1 48%; min-width: 350px; height: 400px;">
          <canvas t-ref="classChartRef"
                  style="width:100%;height:100%;display:block;"/>
          <t t-if="state.selectedClassId and state.classData.length === 0">
            <p class="text-warning">Tidak ada data untuk kelas ini.</p>
          </t>
        </div>
      </div>

      <!-- â”€â”€ Grafik #3: Total Poin per Mahasiswa by Label Group â”€â”€ -->
      <t t-if="state.selectedWeekId">
        <h3 class="mt-5">ðŸ‘¥ Total Poin per Mahasiswa by Label Group</h3>
        <div style="height: 300px; margin-top: 1rem;">
          <canvas t-ref="studentChartRef"
                  style="width:100%;height:100%;display:block;"/>
        </div>
        <t t-if="state.studentData.length === 0">
          <p class="text-warning">Tidak ada data untuk minggu terpilih.</p>
        </t>
      </t>
    </div>
  </t>
</templates>
