<templates xml:space="preserve">
  <t t-name="jtk_logbook_analytics.LogbookDashboard" owl="1">
    <div class="logbook-dashboard-wrapper p-3">
      <h2>ğŸ“Š Dashboard Analitik Logbook</h2>

      <!-- Pilih Project -->
      <div class="mb-3">
        <label class="form-label">ğŸ“˜ Pilih Project:</label>
        <select class="form-select"
                t-att-value="state.selectedProjectId"
                t-on-change="onProjectChange">
          <option value="">-- Pilih Project --</option>
          <t t-foreach="state.projects" t-as="proj" t-key="proj.id">
            <option t-att-value="proj.id">
              <t t-esc="proj.name"/>
            </option>
          </t>
        </select>
      </div>

      <!-- Pesan jika belum pilih -->
      <t t-if="!state.selectedProjectId">
        <p class="text-muted">Silakan pilih project terlebih dahulu.</p>
      </t>
      <t t-if="state.selectedProjectId and !state.selectedWeekId">
        <p class="text-muted">Silakan pilih minggu untuk melihat grafik.</p>
      </t>

      <t t-if="state.selectedProjectId">

      <div class="chart-row">
        <div class="dashboard-panel">
          <div class="panel-header">
            <label class="form-label">ğŸ“… Pilih Minggu:</label>
            <select class="form-select" t-att-value="state.selectedWeekId" t-on-change="onWeekChange">
              <option value="">-- Pilih Minggu --</option>
              <t t-foreach="state.weeks" t-as="w" t-key="w.id">
                <option t-att-value="w.id"><t t-esc="w.name"/></option>
              </t>
            </select>
          </div>
          <div class="chart-container">
            <canvas t-ref="barChartRef"></canvas>
          </div>
        </div>

        <div class="dashboard-panel">
          <div class="panel-header">
            <label class="form-label">ğŸ‘¥ Pilih Kelas:</label>
            <select class="form-select" t-att-value="state.selectedClassId" t-on-change="onClassChange">
              <option value="">-- Pilih Kelas --</option>
              <t t-foreach="state.classes" t-as="cls" t-key="cls.id">
                <option t-att-value="cls.id"><t t-esc="cls.name"/></option>
              </t>
            </select>
          </div>
          <div class="chart-container">
            <canvas t-ref="classChartRef"></canvas>
          </div>
        </div>
      </div>





        <!-- â”€â”€ Grafik #3: Total Poin per Mahasiswa by Label Group â”€â”€ -->
        <t t-if="state.selectedWeekId">
          <h3 class="mt-5">ğŸ‘¥ Total Poin per Mahasiswa by Label Group</h3>
          <div style="height: 300px; margin-top: 1rem;">
            <canvas t-ref="studentChartRef"
                    style="width:100%;height:100%;display:block;"/>
          </div>
          <t t-if="state.studentData.length === 0">
            <p class="text-warning">Tidak ada data untuk minggu terpilih.</p>
          </t>
        </t>

        <!-- â”€â”€ Grafik #4: Total Poin per Label Group by Mahasiswa â”€â”€ -->

        <div class="mb-3">
          <label class="form-label">ğŸ¯ Pilih Label Group:</label>
          <select class="form-select"
                  t-on-change="onLabelGroupChange">
            <option value="">-- Semua --</option>
            <t t-foreach="state.labelGroups" t-as="lg" t-key="lg.id">
              <option t-att-value="lg.id">
                <t t-esc="lg.name"/>
              </option>
            </t>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">ğŸ·ï¸ Pilih Kelas (Filter Mahasiswa):</label>
          <select class="form-select"
                  t-att-value="state.selectedStudentClassId"
                  t-on-change="onStudentClassChange">
            <option value="">-- Semua Kelas --</option>
            <t t-foreach="state.classes" t-as="cls" t-key="cls.id">
              <option t-att-value="cls.id">
                <t t-esc="cls.name"/>
              </option>
            </t>
          </select>
        </div>
        <div class="d-flex align-items-center mb-2">
          <button
            type="button"
            class="btn btn-sm btn-outline-secondary me-2"
            t-on-click="clearStudentSelection">
            âŒ Batal Semua
          </button>
        </div>

        <div class="mb-3">
          <label class="form-label">ğŸ‘¤ Pilih Mahasiswa:</label>
          <div class="form-control" style="min-height: 38px;">
            <t t-foreach="state.students" t-as="s" t-key="s.id">
              <span class="badge me-1"
                    t-attf-class="{{ state.selectedStudentIds.includes(s.id) 
                                    ? 'bg-primary' 
                                    : 'bg-light text-dark' }}"
                    t-on-click="() => this.toggleStudent(s.id)">
                <t t-esc="s.name"/> (<t t-esc="s.nim"/>)
              </span>
            </t>
          </div>
        </div>

        <!-- â€¦ wrapper grafik #4 â€¦ -->
        <h3 class="mt-4">ğŸ“ˆ Perkembangan Poin Mahasiswa dari Waktu ke Waktu</h3>
        <div style="height:700px; margin-top:1rem;">
          <!-- canvas SELALU ADA, tanpa t-if atau t-att-style -->
          <canvas t-ref="lineChartRef" style="width:100%;height:100%;display:block;"/>
        </div>
        <!-- Pesan instruksi sebelum filter dipilih -->
        <p t-if="!state.selectedLabelGroupId || !state.selectedStudentIds.length" class="text-muted">
          Silakan pilih Label Group dan Mahasiswa terlebih dahulu.
        </p>
        <!-- Pesan 'no data' setelah filter dipilih tapi kosong -->
        <p t-if="state.selectedLabelGroupId and state.selectedStudentIds.length and state.lineChartData.length===0" class="text-warning">
          Tidak ada data untuk pilihan ini.
        </p>

      </t>


    </div>
  </t>
</templates>
